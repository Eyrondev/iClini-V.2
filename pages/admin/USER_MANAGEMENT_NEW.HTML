<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management - iClinic Healthcare Management System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="/assets/js/libs/alpine.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="/assets/js/libs/feather.min.js"></script>
    
    <!-- Inter Font -->
    <link href="/assets/css/libs/inter-font.css" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        .gradient-bg-sidebar {
            background: linear-gradient(135deg, #0056b3 0%, #003d82 100%);
            position: relative;
        }
        
        .gradient-bg-sidebar::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(253, 184, 19, 0.1), transparent);
            pointer-events: none;
        }
        
        .sidebar-item-active {
            background: linear-gradient(90deg, rgba(253, 184, 19, 0.2) 0%, rgba(253, 184, 19, 0.05) 100%);
            border-left: 4px solid #FDB813;
            box-shadow: 0 0 20px rgba(253, 184, 19, 0.2);
        }

        /* Mobile overlay for sidebar */
        .mobile-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 30;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Enhanced table row hover effect */
        .user-row {
            transition: all 0.2s ease;
        }

        .user-row:hover {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%);
            transform: translateX(4px);
            box-shadow: -4px 0 0 0 #3b82f6;
        }

        /* Animated gradient background */
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animated-gradient {
            background: linear-gradient(270deg, #0056b3, #003d82, #0056b3);
            background-size: 200% 200%;
            animation: gradient-shift 8s ease infinite;
        }

        /* Stats card animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .float-animation {
            animation: float 3s ease-in-out infinite;
        }

        /* Card hover effect */
        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
    </style>

    
    <!-- Mobile Responsive Styles -->
    <style id="mobile-responsive-styles">
        /* Mobile-first responsive utilities */
        @media (max-width: 640px) {
            /* Extra small devices */
            .xs\:text-xs { font-size: 0.75rem; }
            .xs\:text-sm { font-size: 0.875rem; }
            .xs\:p-2 { padding: 0.5rem; }
            .xs\:px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
            .xs\:py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
            .xs\:gap-2 { gap: 0.5rem; }
            .xs\:grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .xs\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        
        /* Touch-friendly targets for mobile */
        @media (max-width: 768px) {
            button, a, input, select, textarea {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Ensure modals are mobile-friendly */
            .modal-content {
                max-width: calc(100vw - 2rem);
                margin: 1rem;
            }
            
            /* Stack elements on mobile */
            .mobile-stack {
                flex-direction: column !important;
            }
            
            /* Hide on mobile */
            .mobile-hide {
                display: none !important;
            }
            
            /* Full width on mobile */
            .mobile-full {
                width: 100% !important;
            }
        }
        
        /* Tablet optimization */
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-hide {
                display: none !important;
            }
        }
        
        /* Responsive tables */
        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            
            .responsive-table {
                min-width: 600px;
            }
        }
        
        /* Responsive grid adjustments */
        @media (max-width: 640px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            
            .sm\:grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
            }
        }
        
        /* Responsive padding and margins */
        @media (max-width: 640px) {
            .p-6 { padding: 1rem !important; }
            .p-8 { padding: 1.5rem !important; }
            .px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
            .py-6 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
        }
    </style>

    
    <style>
        /* Custom scrollbar for tables */
        .scrollbar-thin::-webkit-scrollbar {
            height: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Responsive font sizes */
        @media (max-width: 640px) {
            h1 { font-size: 1.5rem !important; }
            h2 { font-size: 1.25rem !important; }
            h3 { font-size: 1.125rem !important; }
        }
        
        /* Mobile-optimized spacing */
        @media (max-width: 640px) {
            .gap-6 { gap: 1rem !important; }
            .gap-8 { gap: 1.5rem !important; }
            .space-y-6 > * + * { margin-top: 1rem !important; }
        }
    </style>
</head>
<body class="bg-gray-50" x-data="{
    sidebarCollapsed: false,
    sidebarHovered: false,
    isMobile: false,
    mobileMenuOpen: false,
    userDropdown: false,
    showLogoutConfirm: false,
    showSettingsModal: false,
    showCreateModal: false,
    showEditModal: false,
    showDeleteModal: false,
    showPasswordModal: false,
    selectedUser: null,
    editForm: {
        name: '',
        email: '',
        role: '',
        status: ''
    },
    passwordForm: {
        newPassword: '',
        confirmPassword: ''
    },
    searchQuery: '',
    filterRole: 'all',
    filterStatus: 'all',
    users: [],
    loading: true,
    get filteredUsers() {
        return this.users.filter(user => {
            const matchesSearch = user.name.toLowerCase().includes(this.searchQuery.toLowerCase()) || 
                                user.email.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                                (user.userId && user.userId.toLowerCase().includes(this.searchQuery.toLowerCase()));
            const matchesRole = this.filterRole === 'all' || user.role.toLowerCase() === this.filterRole.toLowerCase();
            const matchesStatus = this.filterStatus === 'all' || user.status.toLowerCase() === this.filterStatus.toLowerCase();
            return matchesSearch && matchesRole && matchesStatus;
        });
    },
    get userStats() {
        return {
            total: this.users.length,
            students: this.users.filter(u => u.role === 'Student').length,
            teachingStaff: this.users.filter(u => u.role === 'Teaching Staff').length,
            nonTeachingStaff: this.users.filter(u => u.role === 'Non-Teaching Staff').length,
            deans: this.users.filter(u => u.role === 'Dean').length,
            president: this.users.filter(u => u.role === 'President').length
        };
    },
    async loadUsers() {
        try {
            console.log('üì• Loading users from database...');
            const response = await fetch('/api/users');
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            this.users = data.users || [];
            console.log(`‚úÖ Loaded ${this.users.length} users from database`);
            
            // Re-initialize feather icons after data loads
            this.$nextTick(() => {
                this.safeInitFeatherIcons();
            });
        } catch (error) {
            console.error('‚ùå Error loading users:', error);
            alert('Failed to load users from database');
        } finally {
            this.loading = false;
        }
    },
    async refreshUsers() {
        this.loading = true;
        await this.loadUsers();
    },
    openEditModal(user) {
        this.selectedUser = user;
        this.editForm = {
            name: user.name,
            email: user.email,
            role: user.role,
            status: user.status
        };
        this.showEditModal = true;
    },
    async updateUser() {
        if (!this.selectedUser) return;
        
        try {
            const response = await fetch(`/api/users/${this.selectedUser.id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(this.editForm)
            });
            
            if (!response.ok) {
                throw new Error('Failed to update user');
            }
            
            const data = await response.json();
            console.log('‚úÖ User updated successfully');
            alert('User information updated successfully!');
            
            this.showEditModal = false;
            await this.refreshUsers();
        } catch (error) {
            console.error('‚ùå Error updating user:', error);
            alert('Failed to update user information');
        }
    },
    openPasswordModal(user) {
        this.selectedUser = user;
        this.passwordForm = {
            newPassword: '',
            confirmPassword: ''
        };
        this.showPasswordModal = true;
    },
    async resetPassword() {
        if (!this.selectedUser) return;
        
        if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {
            alert('Passwords do not match!');
            return;
        }
        
        if (this.passwordForm.newPassword.length < 6) {
            alert('Password must be at least 6 characters long');
            return;
        }
        
        try {
            const response = await fetch(`/api/users/${this.selectedUser.id}/reset-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    newPassword: this.passwordForm.newPassword
                })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                console.error('‚ùå Server error:', data);
                alert(`Failed to reset password: ${data.error || 'Unknown error'}`);
                return;
            }
            
            console.log('‚úÖ Password reset successfully');
            alert('Password reset successfully! User can now login with the new password.');
            
            this.showPasswordModal = false;
            this.passwordForm = { newPassword: '', confirmPassword: '' };
        } catch (error) {
            console.error('‚ùå Error resetting password:', error);
            alert('Failed to reset password. Please check the console for details.');
        }
    },
    safeInitFeatherIcons() {
        if (typeof feather === 'undefined') return;
        
        try {
            // Get all feather icon elements
            const icons = document.querySelectorAll('[data-feather]');
            
            icons.forEach(icon => {
                try {
                    // Only replace if it's a valid element node
                    if (icon && icon.nodeType === Node.ELEMENT_NODE && icon.parentNode) {
                        const iconName = icon.getAttribute('data-feather');
                        const svgIcon = feather.icons[iconName];
                        
                        if (svgIcon) {
                            const svg = svgIcon.toSvg({
                                class: icon.className,
                                width: icon.getAttribute('width') || '24',
                                height: icon.getAttribute('height') || '24'
                            });
                            
                            const temp = document.createElement('div');
                            temp.innerHTML = svg;
                            const newIcon = temp.firstChild;
                            
                            if (newIcon && icon.parentNode) {
                                icon.parentNode.replaceChild(newIcon, icon);
                            }
                        }
                    }
                } catch (err) {
                    // Skip invalid icons silently
                    console.debug('Skipped invalid icon:', err);
                }
            });
        } catch (error) {
            console.debug('Feather icons initialization skipped:', error);
        }
    },
    init() {
        this.$nextTick(() => {
            this.safeInitFeatherIcons();
        });
        
        // Load users from database
        this.loadUsers();
        
        // Handle responsive sidebar
        this.handleResize();
        window.addEventListener('resize', () => this.handleResize());
        
        // Re-initialize icons when data changes
        this.$watch('filteredUsers', () => {
            this.$nextTick(() => {
                setTimeout(() => {
                    this.safeInitFeatherIcons();
                }, 100);
            });
        });
    },
    handleResize() {
        this.isMobile = window.innerWidth < 768;
        if (this.isMobile) {
            this.sidebarCollapsed = true;
            this.mobileMenuOpen = false;
        }
    },
    toggleMobileMenu() {
        this.mobileMenuOpen = !this.mobileMenuOpen;
    }
}">

    <div class="flex h-screen overflow-hidden">
        <!-- Mobile Overlay -->
        <div class="mobile-overlay md:hidden" 
             :class="{ 'active': mobileMenuOpen }"
             @click="mobileMenuOpen = false"></div>

        <!-- Sidebar -->
        <aside :class="[
                   sidebarCollapsed ? 'w-20' : 'w-64',
                   isMobile && mobileMenuOpen ? 'translate-x-0' : '',
                   isMobile && !mobileMenuOpen ? '-translate-x-full' : ''
               ]" 
               class="fixed left-0 top-0 h-screen gradient-bg-sidebar text-white transition-all duration-300 shadow-2xl z-40"
               @mouseenter="sidebarHovered = true"
               @mouseleave="sidebarHovered = false">
        
            <!-- Logo -->
            <div class="relative p-6">
                <div class="flex items-center gap-3" :class="sidebarCollapsed && !sidebarHovered ? 'justify-center' : ''">
                    <div class="flex items-center justify-center">
                        <img src="{{ url_for('static', filename='img/iclinic-logo.png') }}" alt="Norzagaray College" class="w-14 h-14 object-contain">
                    </div>
                    <div x-show="!sidebarCollapsed || sidebarHovered" x-transition>
                        <h1 class="text-xl font-bold text-white text-base sm:text-lg md:text-xl">iClinic</h1>
                        <p class="text-xs text-yellow-300">Norzagaray College</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="relative mt-8 px-4 space-y-2">
                <!-- Dashboard -->
                <a href="{{ url_for('admin_dashboard') }}"
                   class="flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed && !sidebarHovered ? 'w-full' : ''">
                        <i data-feather="home" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed || sidebarHovered" x-transition class="font-medium">Dashboard</span>
                </a>
                
                <!-- User Management -->
                <a href="{{ url_for('admin_user_management') }}"
                   class="sidebar-item-active flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all group">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed && !sidebarHovered ? 'w-full' : ''">
                        <i data-feather="users" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed || sidebarHovered" x-transition class="font-medium">User Management</span>
                </a>
                
                <!-- Patient Management -->
                <a href="{{ url_for('admin_patient_management') }}"
                   class="flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed && !sidebarHovered ? 'w-full' : ''">
                        <i data-feather="heart" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed || sidebarHovered" x-transition class="font-medium">Patient Management</span>
                </a>
                
                <!-- Reports & Analytics -->
                <a href="{{ url_for('admin_reports') }}"
                   class="flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed && !sidebarHovered ? 'w-full' : ''">
                        <i data-feather="bar-chart-2" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed || sidebarHovered" x-transition class="font-medium">Reports & Analytics</span>
                </a>
            </nav>
        
        <!-- User Profile -->
        <div class="absolute bottom-0 w-full p-4 bg-gradient-to-t from-black/20 to-transparent">
            <div class="relative" @click.outside="userDropdown = false">
                <button @click="userDropdown = !userDropdown" 
                        class="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-white/10 transition-colors" 
                        :class="sidebarCollapsed && !sidebarHovered ? 'justify-center' : ''">
                    <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-full flex items-center justify-center shadow-lg">
                        <span class="text-blue-900 font-bold">{% if user %}{{ user.first_name[0] }}{{ user.last_name[0] }}{% else %}AD{% endif %}</span>
                    </div>
                    <div x-show="!sidebarCollapsed || sidebarHovered" x-transition class="flex-1 text-left">
                        <p class="text-sm font-medium text-white">{% if user %}{{ user.first_name }} {{ user.last_name }}{% else %}Admin User{% endif %}</p>
                        <p class="text-xs text-yellow-300">{% if user.position %}{{ user.position }}{% else %}System Administrator{% endif %}</p>
                    </div>
                    <i x-show="!sidebarCollapsed || sidebarHovered" data-feather="chevron-up" class="w-4 h-4 text-white/70"></i>
                </button>
                
                <!-- User Dropdown -->
                <div x-show="userDropdown" 
                     x-transition
                     class="absolute bottom-full left-4 right-4 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 py-1">
                    <button @click="showLogoutConfirm = true; userDropdown = false" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md mx-1">
                        <i data-feather="log-out" class="w-4 h-4"></i>
                        Logout
                    </button>
                </div>
            </div>
        </div>
        </aside>
        
        <!-- Main Content Area -->
        <div :class="sidebarCollapsed ? 'md:ml-20' : 'md:ml-64'" class="flex-1 flex flex-col transition-all duration-300">
            
            <!-- Mobile Header -->
            <header class="md:hidden bg-white shadow-sm border-b border-gray-200 px-4 py-3 flex items-center justify-between">
                <button @click="toggleMobileMenu()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-feather="menu" class="w-6 h-6 text-gray-600"></i>
                </button>
                <div class="flex items-center gap-2">
                    <img src="{{ url_for('static', filename='img/iclinic-logo.png') }}" alt="iClinic" class="w-8 h-8">
                    <h1 class="text-lg font-bold text-gray-900">User Management</h1>
                </div>
                <div class="w-10"></div> <!-- Spacer for centering -->
            </header>
            
            <!-- Main User Management Content -->
            <main class="flex-1 overflow-y-auto bg-gray-50 p-6 p-3 sm:p-4 md:p-6">
                <!-- Enhanced User Management Header -->
                <div class="animated-gradient text-white shadow-2xl relative overflow-hidden rounded-[2rem] ml-1 mb-8">
                    <!-- Decorative Elements -->
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-32 translate-x-32"></div>
                    <div class="absolute bottom-0 left-0 w-48 h-48 bg-yellow-400/10 rounded-full translate-y-24 -translate-x-24"></div>
                    <div class="absolute top-1/2 left-1/2 w-96 h-96 bg-purple-500/5 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl"></div>
                    
                    <!-- Header Content -->
                    <div class="relative px-6 py-5">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <!-- Title Section -->
                            <div class="flex items-center gap-4">
                                <div class="relative float-animation">
                                    <div class="w-14 h-14 bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-2xl flex items-center justify-center shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-300 hover:scale-110">
                                        <i data-feather="users" class="w-7 h-7 text-blue-900"></i>
                                    </div>
                                    <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full animate-pulse shadow-lg"></div>
                                    <div class="absolute -bottom-1 -left-1 w-3 h-3 bg-blue-400 rounded-full animate-ping"></div>
                                </div>
                                <div>
                                    <div class="flex items-center gap-3 mb-1">
                                        <h1 class="text-2xl sm:text-3xl font-bold text-white drop-shadow-lg text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl">
                                            User Management
                                        </h1>
                                        <span class="px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-xs font-semibold" x-text="`${users.length} Users`"></span>
                                    </div>
                                    <div class="flex items-center gap-2 text-blue-100">
                                        <i data-feather="shield" class="w-3.5 h-3.5"></i>
                                        <span class="text-sm">Manage students, staff, and administrators in the clinic system.</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex items-center gap-2">
                                <button @click="refreshUsers()" class="group bg-white/15 hover:bg-white/25 backdrop-blur-sm text-white px-4 py-2 rounded-xl font-medium border border-white/30 hover:border-white/50 transition-all duration-200 flex items-center gap-2 shadow-lg hover:scale-105">
                                    <div class="w-6 h-6 bg-blue-500/30 rounded-lg flex items-center justify-center group-hover:bg-blue-500/50 transition-colors">
                                        <i data-feather="refresh-cw" class="w-3.5 h-3.5" :class="{ 'animate-spin': loading }"></i>
                                    </div>
                                    <span class="hidden sm:inline">Refresh</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Cards -->
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
                    <!-- Total Users -->
                    <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 sm:p-6 p-4">
                        <div class="flex items-center justify-center mb-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-md">
                                <i data-feather="users" class="w-7 h-7 text-white"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 mb-1 text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl" x-text="userStats.total">0</div>
                            <div class="text-sm text-gray-600 font-medium">Total Users</div>
                        </div>
                    </div>

                    <!-- Students -->
                    <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 sm:p-6 p-4">
                        <div class="flex items-center justify-center mb-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-md">
                                <i data-feather="book-open" class="w-7 h-7 text-white"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 mb-1 text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl" x-text="userStats.students">0</div>
                            <div class="text-sm text-gray-600 font-medium">Students</div>
                        </div>
                    </div>

                    <!-- Teaching Staff -->
                    <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 sm:p-6 p-4">
                        <div class="flex items-center justify-center mb-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-md">
                                <i data-feather="award" class="w-7 h-7 text-white"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 mb-1 text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl" x-text="userStats.teachingStaff">0</div>
                            <div class="text-sm text-gray-600 font-medium">Teaching Staff</div>
                        </div>
                    </div>

                    <!-- Non-Teaching Staff -->
                    <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 sm:p-6 p-4">
                        <div class="flex items-center justify-center mb-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-md">
                                <i data-feather="briefcase" class="w-7 h-7 text-white"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 mb-1 text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl" x-text="userStats.nonTeachingStaff">0</div>
                            <div class="text-sm text-gray-600 font-medium">Non-Teaching Staff</div>
                        </div>
                    </div>

                    <!-- Deans -->
                    <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 sm:p-6 p-4">
                        <div class="flex items-center justify-center mb-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-md">
                                <i data-feather="star" class="w-7 h-7 text-white"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 mb-1 text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl" x-text="userStats.deans">0</div>
                            <div class="text-sm text-gray-600 font-medium">Deans</div>
                        </div>
                    </div>

                    <!-- President -->
                    <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 sm:p-6 p-4">
                        <div class="flex items-center justify-center mb-3">
                            <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center shadow-md">
                                <i data-feather="user-check" class="w-7 h-7 text-white"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 mb-1 text-xl sm:text-2xl md:text-3xl text-lg sm:text-xl md:text-2xl text-base sm:text-lg md:text-xl" x-text="userStats.president">0</div>
                            <div class="text-sm text-gray-600 font-medium">President</div>
                        </div>
                    </div>
                </div>
                
                <!-- Search and Filter -->
                <div class="mb-6 bg-white rounded-2xl shadow-lg border border-gray-200 p-6 sm:p-6 p-4">
                        <div class="flex flex-col lg:flex-row gap-4">
                            <!-- Search Input -->
                            <div class="flex-1">
                                <div class="relative">
                                    <i data-feather="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                                    <input type="text" 
                                           x-model="searchQuery"
                                           placeholder="Search users by name or email..."
                                           class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <div x-show="searchQuery" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                        <button @click="searchQuery = ''" class="text-gray-400 hover:text-gray-600 transition-colors">
                                            <i data-feather="x" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Role Filter -->
                            <div class="sm:w-56">
                                <div class="relative">
                                    <i data-feather="filter" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                    <select x-model="filterRole" 
                                            class="w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white transition-all">
                                        <option value="all">All Roles</option>
                                        <option value="student">Students</option>
                                        <option value="teaching staff">Teaching Staff</option>
                                        <option value="non-teaching staff">Non-Teaching Staff</option>
                                        <option value="dean">Deans</option>
                                        <option value="president">President</option>
                                    </select>
                                    <i data-feather="chevron-down" class="absolute right-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>

                            <!-- Status Filter -->
                            <div class="sm:w-48">
                                <div class="relative">
                                    <i data-feather="toggle-right" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                    <select x-model="filterStatus" 
                                            class="w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white transition-all">
                                        <option value="all">All Status</option>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                    <i data-feather="chevron-down" class="absolute right-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Results Count -->
                        <div class="mt-4 flex items-center justify-between text-sm">
                            <span class="text-gray-600">
                                Showing <span class="font-semibold text-blue-600" x-text="filteredUsers.length"></span> of <span class="font-semibold" x-text="users.length"></span> users
                            </span>
                            <button @click="searchQuery = ''; filterRole = 'all'; filterStatus = 'all'" 
                                    x-show="searchQuery || filterRole !== 'all' || filterStatus !== 'all'"
                                    class="text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1 transition-colors">
                                <i data-feather="x-circle" class="w-4 h-4"></i>
                                Clear filters
                            </button>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                            <table class="w-full">
                                <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200 sticky top-0 z-10">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider bg-gradient-to-r from-gray-50 to-gray-100">User</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider bg-gradient-to-r from-gray-50 to-gray-100">Role</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider bg-gradient-to-r from-gray-50 to-gray-100">Status</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider bg-gradient-to-r from-gray-50 to-gray-100">Date Created</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider bg-gradient-to-r from-gray-50 to-gray-100">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-100">
                                    <!-- Loading State -->
                                    <tr x-show="loading">
                                        <td colspan="5" class="px-6 py-12 text-center">
                                            <div class="flex flex-col items-center justify-center">
                                                <i data-feather="loader" class="w-8 h-8 text-blue-500 animate-spin mb-2"></i>
                                                <p class="text-gray-500">Loading users...</p>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- Empty State -->
                                    <tr x-show="!loading && filteredUsers.length === 0">
                                        <td colspan="5" class="px-6 py-12 text-center">
                                            <div class="flex flex-col items-center justify-center">
                                                <i data-feather="users" class="w-12 h-12 text-gray-400 mb-2"></i>
                                                <p class="text-gray-500 text-lg font-medium">No users found</p>
                                                <p class="text-gray-400 text-sm">Try adjusting your search or filter criteria</p>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- User Rows -->
                                    <template x-for="user in filteredUsers" :key="user.id">
                                        <tr class="user-row">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm shadow-inner flex-shrink-0 bg-gradient-to-br from-blue-400 to-blue-500 text-white"
                                                         :class="{
                                                             'bg-gradient-to-br from-blue-400 to-blue-500 text-white': user.role === 'Student',
                                                             'bg-gradient-to-br from-amber-400 to-amber-500 text-white': user.role === 'Teaching Staff',
                                                             'bg-gradient-to-br from-emerald-400 to-emerald-500 text-white': user.role === 'Non-Teaching Staff',
                                                             'bg-gradient-to-br from-purple-400 to-purple-500 text-white': user.role === 'Dean',
                                                             'bg-gradient-to-br from-red-400 to-red-500 text-white': user.role === 'President',
                                                             'bg-gradient-to-br from-gray-400 to-gray-500 text-white': user.role === 'Visitor'
                                                         }"
                                                         x-text="user.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0,2)">
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-semibold text-gray-900 uppercase" x-text="user.name"></div>
                                                        <div class="text-xs text-gray-500" x-text="user.userId"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold rounded-lg shadow-sm"
                                                      :class="{
                                                          'bg-blue-100 text-blue-800': user.role === 'Student',
                                                          'bg-green-100 text-green-800': user.role === 'Nurse',
                                                          'bg-orange-100 text-orange-800': user.role === 'Teaching Staff',
                                                          'bg-yellow-100 text-yellow-800': user.role === 'Non-Teaching Staff',
                                                          'bg-red-100 text-red-800': user.role === 'Admin'
                                                      }">
                                                    <div class="w-1.5 h-1.5 rounded-full"
                                                         :class="{
                                                             'bg-blue-600': user.role === 'Student',
                                                             'bg-green-600': user.role === 'Nurse',
                                                             'bg-orange-600': user.role === 'Teaching Staff',
                                                             'bg-yellow-600': user.role === 'Non-Teaching Staff',
                                                             'bg-red-600': user.role === 'Admin'
                                                         }"></div>
                                                    <span x-text="user.role"></span>
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold rounded-lg shadow-sm"
                                                      :class="user.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'">
                                                    <div class="w-1.5 h-1.5 rounded-full animate-pulse"
                                                         :class="user.status === 'Active' ? 'bg-green-600' : 'bg-gray-600'"></div>
                                                    <span x-text="user.status"></span>
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center gap-1.5 text-sm text-gray-600">
                                                    <i data-feather="calendar" class="w-3.5 h-3.5 text-gray-400"></i>
                                                    <span x-text="user.dateCreated"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <div class="flex items-center gap-2">
                                                    <!-- Reset Password Button -->
                                                    <button @click="openPasswordModal(user)" 
                                                            class="text-green-600 hover:text-white bg-green-50 hover:bg-green-600 p-2.5 rounded-xl transition-all duration-200 group shadow-sm hover:shadow-md"
                                                            title="Reset Password">
                                                        <i data-feather="key" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                                                    </button>
                                                    <!-- Delete Button -->
                                                    <button @click="selectedUser = user; showDeleteModal = true" 
                                                            class="text-red-600 hover:text-white bg-red-50 hover:bg-red-600 p-2.5 rounded-xl transition-all duration-200 group shadow-sm hover:shadow-md"
                                                            title="Delete User">
                                                        <i data-feather="trash-2" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create User Modal -->
    <div x-show="showCreateModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
         @click.outside="showCreateModal = false">
        
        <div x-show="showCreateModal"
             x-transition:enter="transition ease-out duration-300 transform"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200 transform"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden max-w-full sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-2 sm:mx-4">
            
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                            <i data-feather="user-plus" class="w-5 h-5 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-base sm:text-lg md:text-xl">Add New User</h2>
                            <p class="text-blue-100 text-sm">Create a new user account</p>
                        </div>
                    </div>
                    <button @click="showCreateModal = false" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <form class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 grid-cols-1 sm:grid-cols-2">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter full name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter email address">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select role</option>
                                <option value="Student">Student</option>
                                <option value="Nurse">Nurse</option>
                                <option value="Teaching Staff">Teaching Staff</option>
                                <option value="Non-Teaching Staff">Non-Teaching Staff</option>
                                <option value="Admin">Administrator</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="tel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter phone number">
                    </div>
                    
                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                        <button type="button" @click="showCreateModal = false" 
                                class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                            Create User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div x-show="showEditModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
         @click.outside="showEditModal = false">
        
        <div x-show="showEditModal"
             x-transition:enter="transition ease-out duration-300 transform"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200 transform"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden max-w-full sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-2 sm:mx-4">
            
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-green-600 to-green-700 px-6 py-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                            <i data-feather="edit-2" class="w-5 h-5 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-base sm:text-lg md:text-xl">Edit User</h2>
                            <p class="text-green-100 text-sm" x-text="selectedUser ? `Editing ${selectedUser.name}` : 'Update user information'"></p>
                        </div>
                    </div>
                    <button @click="showEditModal = false" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <form class="space-y-6" @submit.prevent="updateUser()">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 grid-cols-1 sm:grid-cols-2">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" x-model="editForm.name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" x-model="editForm.email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                            <select x-model="editForm.role" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="Student">Student</option>
                                <option value="Teaching Staff">Teaching Staff</option>
                                <option value="Non-Teaching Staff">Non-Teaching Staff</option>
                                <option value="Dean">Dean</option>
                                <option value="President">President</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select x-model="editForm.status" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                        <button type="button" @click="showEditModal = false" 
                                class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2">
                            <i data-feather="save" class="w-4 h-4"></i>
                            Update User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete User Modal -->
    <div x-show="showDeleteModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
         @click.outside="showDeleteModal = false">
        
        <div x-show="showDeleteModal"
             x-transition:enter="transition ease-out duration-300 transform"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200 transform"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
            
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                            <i data-feather="trash-2" class="w-5 h-5 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-base sm:text-lg md:text-xl">Delete User</h2>
                            <p class="text-red-100 text-sm">This action cannot be undone</p>
                        </div>
                    </div>
                    <button @click="showDeleteModal = false" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-feather="alert-triangle" class="w-8 h-8 text-red-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Are you sure?</h3>
                    <p class="text-gray-600" x-show="selectedUser">
                        You are about to delete <strong x-text="selectedUser?.name"></strong>. This action cannot be undone and will permanently remove all associated data.
                    </p>
                </div>
                
                <div class="flex justify-end gap-3">
                    <button type="button" @click="showDeleteModal = false" 
                            class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button type="button" 
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                        Delete User
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div x-show="showPasswordModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
         @click.outside="showPasswordModal = false">
        
        <div x-show="showPasswordModal"
             x-transition:enter="transition ease-out duration-300 transform"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200 transform"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
            
            <!-- Modal Header -->
            <div class="animated-gradient px-6 py-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-yellow-400/30 rounded-lg flex items-center justify-center">
                            <i data-feather="key" class="w-5 h-5 text-yellow-400"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-base sm:text-lg md:text-xl">Reset Password</h2>
                            <p class="text-blue-100 text-sm" x-text="selectedUser ? `Reset password for ${selectedUser.name}` : 'Set new password'"></p>
                        </div>
                    </div>
                    <button @click="showPasswordModal = false" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6">
                <form @submit.prevent="resetPassword()" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                        <input type="password" 
                               x-model="passwordForm.newPassword" 
                               required 
                               minlength="6"
                               placeholder="Enter new password (min. 6 characters)"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                        <input type="password" 
                               x-model="passwordForm.confirmPassword" 
                               required 
                               minlength="6"
                               placeholder="Re-enter new password"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-2">
                        <i data-feather="alert-circle" class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"></i>
                        <p class="text-sm text-yellow-800">
                            The user will need to use this new password to log in. Make sure to communicate it securely.
                        </p>
                    </div>
                    
                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                        <button type="button" @click="showPasswordModal = false" 
                                class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg transition-colors flex items-center gap-2 shadow-lg">
                            <i data-feather="check" class="w-4 h-4"></i>
                            Reset Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Safe Feather Icons Initialization
        function safeFeatherReplace() {
            if (typeof feather === 'undefined') return;
            
            try {
                // Get all feather icon elements
                const icons = document.querySelectorAll('[data-feather]');
                
                icons.forEach(icon => {
                    // Skip if already replaced or invalid
                    if (!icon || icon.tagName.toLowerCase() === 'svg') return;
                    
                    // Validate it's a proper element node
                    if (icon.nodeType !== Node.ELEMENT_NODE) return;
                    
                    // Check if parent exists
                    if (!icon.parentNode) return;
                    
                    try {
                        // Get icon name
                        const iconName = icon.getAttribute('data-feather');
                        if (!iconName) return;
                        
                        // Create SVG element
                        const svg = feather.icons[iconName];
                        if (!svg) return;
                        
                        // Convert to DOM element
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = svg.toSvg({
                            class: icon.className,
                            'stroke-width': icon.getAttribute('stroke-width') || 2
                        });
                        
                        const svgElement = tempDiv.firstChild;
                        if (svgElement && icon.parentNode) {
                            icon.parentNode.replaceChild(svgElement, icon);
                        }
                    } catch (e) {
                        // Silently skip problematic icons
                        console.debug('Skipped icon:', icon.getAttribute('data-feather'));
                    }
                });
            } catch (error) {
                console.debug('Feather replace skipped:', error.message);
            }
        }
        
        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(safeFeatherReplace, 100);
        });
        
        // Initialize after Alpine.js loads
        document.addEventListener('alpine:init', () => {
            setTimeout(safeFeatherReplace, 300);
            setTimeout(safeFeatherReplace, 600);
        });
        
        // Re-initialize when Alpine updates DOM
        document.addEventListener('alpine:updated', () => {
            setTimeout(safeFeatherReplace, 100);
        });
        
        // Periodic refresh for dynamic content
        let refreshCount = 0;
        const refreshInterval = setInterval(() => {
            safeFeatherReplace();
            refreshCount++;
            // Stop after 10 attempts (20 seconds)
            if (refreshCount >= 10) {
                clearInterval(refreshInterval);
            }
        }, 2000);
    </script>

    <!-- Logout Confirmation Modal -->
    <div x-show="showLogoutConfirm" x-cloak
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
         @click.self="showLogoutConfirm = false">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                        <i data-feather="log-out" class="w-6 h-6 text-red-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Confirm Logout</h3>
                </div>
                
                <p class="text-gray-600 mb-6">Are you sure you want to logout? You will need to login again to access the system.</p>
                
                <div class="flex justify-end gap-3">
                    <button @click="showLogoutConfirm = false"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button @click="window.location.href = '{{ url_for('logout') }}'"
                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Yes, Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
